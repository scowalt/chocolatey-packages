name: Update packages
on:
  workflow_dispatch:
  schedule:
    - cron: '5 4 * * *'

jobs:
  cryptomator-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Get current cryptomator version
        id: current-version
        run: |
          echo ::set-output name=version::$(./scripts/get_nuspec_verison.py ./packages/cryptomator/cryptomator.nuspec)
      - uses: actions/github-script@v6
        id: latest-release
        with:
          script: |
            return (await github.rest.repos.getLatestRelease({
              owner: "cryptomator",
              repo: "cryptomator",
            })).data.tag_name;
          result-encoding: string
      - name: Get result
        run: |
          echo "${{steps.current-version.outputs.version}}"
          echo "${{steps.latest-release.outputs.result}}"
      - id: has-newer-version
        run: |
          echo ::set-output name=hasNewerVersion::$(./scripts/has_newer_version.py "${{steps.current-version.outputs.version}}" "${{steps.latest-release.outputs.result}}")
      - name: To be removed
        run: |
          echo "${{steps.has-newer-version.outputs.hasNewerVersion}}"

  cryptomator-update:
    runs-on: windows-latest
    steps:
      - name: Hello world
        run: echo "Hello world"
